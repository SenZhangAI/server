--echo #
--echo # MDEV-20016 Add MariaDB_DATA_TYPE_PLUGIN
--echo #

--vertical_results
SELECT
  PLUGIN_NAME,
  PLUGIN_VERSION,
  PLUGIN_STATUS,
  PLUGIN_TYPE,
  PLUGIN_AUTHOR,
  PLUGIN_DESCRIPTION,
  PLUGIN_LICENSE,
  PLUGIN_MATURITY,
  PLUGIN_AUTH_VERSION
FROM INFORMATION_SCHEMA.PLUGINS
  WHERE PLUGIN_TYPE='DATA TYPE'
    AND PLUGIN_NAME='TEST_INT8';
--horizontal_results

CREATE TABLE t1 (a TEST_INT8);
SHOW CREATE TABLE t1;
DROP TABLE t1;

SELECT CAST('100' AS TEST_INT8) AS cast;

DELIMITER $$;
BEGIN NOT ATOMIC
  DECLARE a TEST_INT8 DEFAULT 256;
  SELECT HEX(a), a;
END;
$$
DELIMITER ;$$

CREATE FUNCTION f1(p TEST_INT8) RETURNS TEST_INT8 RETURN 1;
SHOW CREATE FUNCTION f1;
SELECT f1(10);
DROP FUNCTION f1;

CREATE TABLE t1 (a TEST_INT8);
CREATE TABLE t2 AS SELECT a FROM t1;
SHOW CREATE TABLE t2;
DROP TABLE t2;
DROP TABLE t1;

CREATE TABLE t1 (a TEST_INT8);
CREATE TABLE t2 AS SELECT COALESCE(a,a) FROM t1;
SHOW CREATE TABLE t2;
DROP TABLE t2;
DROP TABLE t1;

CREATE TABLE t1 (a TEST_INT8);
CREATE TABLE t2 AS SELECT LEAST(a,a) FROM t1;
SHOW CREATE TABLE t2;
DROP TABLE t2;
DROP TABLE t1;

CREATE TABLE t1 (a TEST_INT8);
INSERT INTO t1 VALUES (1),(2);
CREATE TABLE t2 AS SELECT MIN(a), MAX(a) FROM t1;
SELECT * FROM t2;
SHOW CREATE TABLE t2;
DROP TABLE t2;
DROP TABLE t1;

CREATE TABLE t1 (id INT, a TEST_INT8);
INSERT INTO t1 VALUES (1,1),(1,2),(2,1),(2,2);
CREATE TABLE t2 AS SELECT id, MIN(a), MAX(a) FROM t1 GROUP BY id;
SELECT * FROM t2;
SHOW CREATE TABLE t2;
DROP TABLE t2;
DROP TABLE t1;

CREATE TABLE t1 (a TEST_INT8);
INSERT INTO t1 VALUES (1),(2);
CREATE TABLE t2 AS SELECT DISTINCT a FROM t1;
SELECT * FROM t2;
SHOW CREATE TABLE t2;
DROP TABLE t2;
DROP TABLE t1;

CREATE TABLE t1 (a TEST_INT8);
INSERT INTO t1 VALUES (1);
CREATE TABLE t2 AS SELECT (SELECT a FROM t1) AS c1;
SELECT * FROM t2;
SHOW CREATE TABLE t2;
DROP TABLE t2;
DROP TABLE t1;

CREATE TABLE t1 (a TEST_INT8);
CREATE TABLE t2 AS SELECT a FROM t1 UNION SELECT a FROM t1;
SHOW CREATE TABLE t2;
DROP TABLE t2;
DROP TABLE t1;
